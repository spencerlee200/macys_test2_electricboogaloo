wwplayer.define(["module","BaseModule","jquery","globals","underscore","apiService","pubsub","TweenMax"],function(t,e,n,o,i,a,u,r){"use strict";function l(t){return t&&t.__esModule?t:{default:t}}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var c=l(e),v=l(n),y=l(o),p=(l(i),l(a)),g=l(u),m=l(r),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),I=void 0,C=m.default;t.exports=function(t){function e(t){d(this,e);var n=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return I=n,I.loadStyleHead(window.wirewax.moduleUrl+"style/33183.css"),I.toolkit.loadFont("creativeData/fonts/HelveticaNeueLTStd-BdCn/","HelveticaNeueLTStd-BdCn","HelveticaNeueLTStd-BdCn"),I.toolkit.loadFont("creativeData/fonts/HelveticaNeueLTPro-Md/","HelveticaNeueLTPro-Md","HelveticaNeueLTPro-Md"),window.wirewax.allow360Portrait=!0,g.default.subscribe("tagClicked",I.tagClicked),g.default.subscribe("showHideIcons",I.showHideIcons),I.player.config.minPitch=-45,I.player.config.maxPitch=28,I.player.dragDisabled=!0,y.default.LOOP=!0,g.default.subscribe("giftData",function(t,e){I.sheetData=e,I.setCounter()}),(0,v.default)("#control-overlay .turn-phone-message").remove(),y.default.ENABLE_OVERLAY_FULL_BLEED=!0,y.default.IS_360_FULLBLEED=!0,(0,v.default)(window).resize(function(){y.default.IS_DESKTOP||window.setTimeout(function(){I.onResize()},100)}),I.onResize(),I.setupAll(),n}return s(e,t),h(e,[{key:"setupAll",value:function(){var t=y.default.IS_DESKTOP?"":I.mobileOrientation;I.mainOverlay=(0,v.default)('<div id="mainHUD" class="'+t+'">\n                <div id="Is_360_Prompt"></div>\n                <div id="giftCounter_Holder">\n                    <div id="giftCounterBG"></div>\n                    <div id="giftCounter_Copy">\n                        <span id="giftCounter_foundCount"></span>/<span id="giftCounter_maxItems"></span>\n                    </div>\n                </div>\n                <div id="giftCounter_Instructions">GIFTS<br>YOU\'VE<br>FOUND</div>\n                <div id="giftListIcon"></div>\n                <div id="giftList_Instructions">GIFTS<br>TO FIND</div>\n                <div id="introScreen">\n                    <div id="introBG"></div>\n                    <div id="intro_SplashCopy">BELIEVE IN THE WONDER OF GIVING</div>\n                    <div id="introInnards">\n                        <div id="hex_Holder">\n                            <div id="hexIntro" class="hexInternal"></div>\n                            <div id="hexInstructions" class="hexInternal"></div>\n                        </div><br>\n                        <div id="introScreen_PlayButton"></div><br>\n                        <div id="macysLogo"></div>\n                    </div>\n                </div>\n                <div id="navIcons_Holder">\n                    <div id="twitterIcon" class="navIcon"></div>\n                    <div id="facebookIcon" class="navIcon"></div>\n                    <div id="volumeIcon" class="navIcon"></div>\n                </div>\n                <div id="outdatedBrowserOverlay"></div>\n            </div>'),(0,v.default)("#waxxer #widget-overlay").append(I.mainOverlay),I.shootingStar=I.mainOverlay.find("#shootingStar"),I.giftCounterHolder=I.mainOverlay.find("#giftCounter_Holder"),I.giftCounterFoundCount=I.mainOverlay.find("#giftCounter_foundCount"),I.giftCounterMaxItems=I.mainOverlay.find("#giftCounter_maxItems"),I.giftCounterInstructions=I.mainOverlay.find("#giftCounter_Instructions"),I.giftListButton=I.mainOverlay.find("#giftListIcon"),I.giftListInstructions=I.mainOverlay.find("#giftList_Instructions"),I.navIcons=I.mainOverlay.find("#navIcons_Holder"),I.volumeButton=I.mainOverlay.find("#volumeIcon"),I.twitterButton=I.mainOverlay.find("#twitterIcon"),I.facebookButton=I.mainOverlay.find("#facebookIcon"),I.introScreen=I.mainOverlay.find("#introScreen"),I.introBG=I.mainOverlay.find("#introBG"),I.introSplashCopy=I.mainOverlay.find("#intro_SplashCopy"),I.hexHolder=I.mainOverlay.find("#hex_Holder"),I.hexIntro=I.mainOverlay.find("#hexIntro"),I.hexInstructions=I.mainOverlay.find("#hexInstructions"),I.introPlayButton=I.mainOverlay.find("#introScreen_PlayButton"),I.macysLogo=I.mainOverlay.find("#macysLogo"),I.is360Icon=I.mainOverlay.find("#Is_360_Prompt"),I.isOutdated=I.mainOverlay.find("#outdatedBrowserOverlay"),I.allMute=!1,I.isFullScreen=!1,I.giftsFoundCounter=0,C.set([I.introSplashCopy,I.is360Icon,I.twitterButton,I.facebookButton,I.volumeButton,I.isOutdated],{autoAlpha:0}),C.set(I.hexInstructions,{rotationY:-180}),C.set([I.hexInstructions,I.hexIntro,I.hexHolder,I.introScreen],{perspective:1e3}),C.set(I.giftCounterHolder,{transformOrign:"50% 75%"}),C.set(I.introPlayButton,{xPercent:"-50"});var e=(y.default.IS_SAFARI_VERSION,navigator.userAgent.indexOf("Pinterest")>=0);e&&I.isOutdated.addClass("isPinterest"),(y.default.IS_SAFARI_VERSION<=11&&!y.default.IS_DESKTOP&&!y.default.IS_FIREFOX&&!y.default.IS_CHROME||e&&!y.default.IS_DESKTOP)&&C.set(I.isOutdated,{autoAlpha:0}),I.giftCounterFoundCount.text("00"),y.default.IS_DESKTOP&&((0,v.default)(I.giftCounterHolder).mouseover(function(){C.to(I.giftCounterHolder,.2,{scale:1.05,force3D:!1})}),(0,v.default)(I.giftCounterHolder).mouseout(function(){C.to(I.giftCounterHolder,.2,{scale:1,force3D:!1})}),[I.volumeButton,I.twitterButton,I.giftListButton,I.facebookButton].map(function(t){(0,v.default)(t).mouseover(function(){C.to(this,.2,{scale:1.1,force3D:!1})}),(0,v.default)(t).mouseout(function(){C.to(this,.2,{scale:1,force3D:!1})})}),(0,v.default)(I.introPlayButton).mouseover(function(){C.to(I.introPlayButton,.2,{scale:1.05,force3D:!1})}),(0,v.default)(I.introPlayButton).mouseout(function(){C.to(I.introPlayButton,.2,{scale:1,force3D:!1})}),(0,v.default)(I.isOutdated).on(y.default.CLICK_EVENT,function(){I.doClickout("https://browsehappy.com/","Upgrade browser link out")})),(0,v.default)(I.giftCounterHolder).on(y.default.CLICK_EVENT,function(){g.default.publish("openWishList","on")}),(0,v.default)(I.giftListButton).on(y.default.CLICK_EVENT,function(){g.default.publish("giftListClicked","on")}),(0,v.default)(I.volumeButton).on(y.default.CLICK_EVENT,function(){I.muteVolume()}),(0,v.default)(I.twitterButton).on(y.default.CLICK_EVENT,function(){I.socialShare("Twitter")}),(0,v.default)(I.facebookButton).on(y.default.CLICK_EVENT,function(){I.socialShare("Facebook")}),(0,v.default)(I.introPlayButton).on(y.default.CLICK_EVENT,function(){I.showInstructions()}),(0,v.default)(window).resize()}},{key:"setCounter",value:function(){I.giftsTotal=I.sheetData.length,I.giftCounterMaxItems.text(I.giftsTotal)}},{key:"socialShare",value:function(t){switch(t){case"Facebook":p.default.widgetShareClick("fb","I found "+I.giftsFoundCounter+" hidden gift"+(1==I.giftsFoundCounter?"":"s")+". How many can you find?","www.macysgiftglobe.com",null,null);break;case"Twitter":p.default.widgetShareClick("tw","I found "+I.giftsFoundCounter+" gift"+(1==I.giftsFoundCounter?"":"s")+" hidden inside @Macys Gift Globe. How many can you find? www.macysgiftglobe.com #MacysBelieve","www.macysgiftglobe.com",null,null)}}},{key:"showHideIcons",value:function(t,e){"show"==e?C.to([I.giftCounterHolder,I.giftListButton,I.navIcons],.2,{autoAlpha:1}):C.to([I.giftCounterHolder,I.giftListButton,I.navIcons],.2,{autoAlpha:0})}},{key:"showInstructions",value:function(){C.to(I.hexIntro,.8,{rotationY:180}),C.to(I.hexInstructions,.8,{rotationY:0}),C.to(I.introPlayButton,.4,{autoAlpha:0}),C.to(I.hexHolder,.4,{autoAlpha:0,delay:5}),C.to(I.introSplashCopy,.4,{autoAlpha:1,delay:5.2,onComplete:function(){1!=I.experienceStarted&&C.delayedCall(3,I.startExperience)}}),g.default.publish("playSound","MainSong"),(0,v.default)(window).focus(function(){g.default.publish("playSound","MainSong")}),(0,v.default)(window).blur(function(){g.default.publish("pauseSound","MainSong")}),C.to(I.volumeButton,.2,{autoAlpha:1}),(0,v.default)(I.introBG).add(I.hexHolder).on(y.default.CLICK_EVENT,function(){I.startExperience()})}},{key:"startExperience",value:function(){I.experienceStarted=!0,C.killDelayedCallsTo(I.startExperience);var t="-=1000";y.default.IS_DESKTOP||(t="isLandscape"==I.mobileOrientation?"-=200":"-=400"),I.player.play(),C.to([I.hexHolder,I.introSplashCopy],.4,{autoAlpha:0}),C.to([I.introScreen],2,{scale:6,y:t,ease:Power3.easeIn,delay:.4,force3D:!0,rotationZ:.01}),C.to(I.introScreen,.4,{autoAlpha:0,delay:2,force3D:!0,rotationZ:.01,onComplete:function(){I.initMain()}})}},{key:"initMain",value:function(){(0,v.default)(window).focus(function(){I.player.play()}),(0,v.default)(window).blur(function(){I.player.pause()}),I.introScreen.remove(),I.player.dragDisabled=!1,C.to([I.facebookButton,I.twitterButton],.2,{autoAlpha:1}),C.to(I.is360Icon,.4,{autoAlpha:1}),C.to(I.is360Icon,.4,{autoAlpha:0,delay:3}),C.to([I.giftCounterInstructions,I.giftListInstructions],.4,{autoAlpha:0,delay:10}),g.default.publish("controlTwinkling","start")}},{key:"tagClicked",value:function(t,e){I.giftsFoundCounter++,I.updateGiftCounter(),I.giftsFoundCounter==I.giftsTotal&&g.default.publish("allGiftsFound",!0)}},{key:"updateGiftCounter",value:function(){var t=I.giftsFoundCounter<10?"0"+I.giftsFoundCounter:I.giftsFoundCounter;t=t<I.giftsTotal?t:I.giftsTotal,I.giftCounterFoundCount.text(t),C.fromTo(I.giftCounterHolder,.15,{scale:1},{scale:1.1,ease:Power2.easeOut,force3D:!1,repeat:1,yoyo:!0})}},{key:"muteVolume",value:function(){I.allMute=!I.allMute,document.querySelectorAll("video").forEach(function(t){return t.muted=I.allMute}),document.querySelectorAll("audio").forEach(function(t){return t.muted=I.allMute}),(0,v.default)("#volume-bar-icon").click();var t=I.mainOverlay.find("#volumeIcon");0==I.allMute?t.removeClass("volumeIcon_Off"):t.addClass("volumeIcon_Off")}},{key:"onResize",value:function(){y.default.IS_DESKTOP||I.checkWindowMode()}},{key:"checkWindowMode",value:function(){window.innerHeight>window.innerWidth?(I.mobileOrientation="isPortrait",I.player.config.hfov=50):(I.mobileOrientation="isLandscape",I.player.config.hfov=100),I.mainOverlay&&I.mainOverlay.attr("class",I.mobileOrientation),g.default.publish("mobileOrientationChange",I.mobileOrientation)}}]),e}(c.default)});
