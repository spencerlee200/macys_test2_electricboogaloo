wwplayer.define(["Class","globals","pubsub","jquery"],function(i,e,n,a){var t;return i.extend({init:function(i){t=this,t.deviceOrientation={screenOrientation:0,z:0,gamma:0,alpha:0},t.initialCompassHeading=null,t.updatingInitialCompassHeading=!0,t.onOrientationUpdateCallBack=i,t.updateScreenOrientation(window.orientation),window!=window.top?(n.subscribe(e.DEVICE_ORIENTATION,function(i,e){t.handleDeviceOrientation(e)}),n.subscribe(e.DEVICE_MOTION,function(i,e){t.handleDeviceMotion(e)}),n.subscribe(e.DEVICE_SCREEN_ORIENTATION,function(i,e){t.updateScreenOrientation(e)})):(window.addEventListener("devicemotion",t.handleDeviceMotion,!1),window.addEventListener("deviceorientation",t.handleDeviceOrientation,!0),window.addEventListener("orientationchange",t.handleScreenOrientation,!1)),n.subscribe(e.HAS_PLAYED,function(){t.updatingInitialCompassHeading=!1})},handleScreenOrientation:function(){t.updateScreenOrientation(window.orientation)},updateScreenOrientation:function(i){t.deviceOrientation.screenOrientation=i},handleDeviceMotion:function(i){t.deviceOrientation.z=i.accelerationIncludingGravity.z},handleDeviceOrientation:function(i){e.IS_ANDROID?t.handleAndroidOrientation(i):(e.IS_IPHONE||e.IS_IPAD)&&t.handleIphoneOrientation(i),t.onOrientationUpdateCallBack&&t.onOrientationUpdateCallBack(t.deviceOrientation)},handleAndroidOrientation:function(i){var e=i.gamma,n=i.alpha,a=i.beta;return-90===t.deviceOrientation.screenOrientation?(t.deviceOrientation.gamma=e<=0?e+90:e-90,n*=-1,t.deviceOrientation.alpha=t.deviceOrientation.z<=0?n+180:n):90===t.deviceOrientation.screenOrientation?(e*=-1,t.deviceOrientation.gamma=t.deviceOrientation.z<0?e+90:e-90,n*=-1,t.deviceOrientation.alpha=t.deviceOrientation.z>=0?n+180:n):0===t.deviceOrientation.screenOrientation?(t.deviceOrientation.gamma=a<=0?a+90:a-90,n*=-1,t.deviceOrientation.alpha=t.deviceOrientation.z<=0?n+180:n):180===t.deviceOrientation.screenOrientation&&(t.deviceOrientation.gamma=t.deviceOrientation.z<0?a+90:a-90,n*=-1,t.deviceOrientation.alpha=t.deviceOrientation.z>=0?n+180:n),!0},handleIphoneOrientation:function(i){var e=i.gamma,n=i.beta,a=i.webkitCompassHeading,o=480==window.screen.height;return t.updatingInitialCompassHeading&&(t.initialCompassHeading=a),-90===t.deviceOrientation.screenOrientation?o?(t.deviceOrientation.gamma=e-90,t.deviceOrientation.alpha=(a-90-t.initialCompassHeading)%360):(t.deviceOrientation.gamma=t.deviceOrientation.z>0?e+90:e-90,t.deviceOrientation.alpha=(a-90-t.initialCompassHeading)%360):90===t.deviceOrientation.screenOrientation?o?(t.deviceOrientation.gamma=-1*e-90,t.deviceOrientation.alpha=(a+90-t.initialCompassHeading)%360):(e*=-1,t.deviceOrientation.gamma=t.deviceOrientation.z>0?e+90:e-90,t.deviceOrientation.alpha=(a+90-t.initialCompassHeading)%360):0===t.deviceOrientation.screenOrientation?(t.deviceOrientation.gamma=n-90,t.deviceOrientation.alpha=(a-t.initialCompassHeading)%360):180===t.deviceOrientation.screenOrientation&&(o?(t.deviceOrientation.gamma=-1*n,t.deviceOrientation.alpha=(a-t.initialCompassHeading)%360):(n*=-1,t.deviceOrientation.gamma=n-90,t.deviceOrientation.alpha=(a-t.initialCompassHeading)%360)),!0},onOrientationUpdate:function(i){}})});